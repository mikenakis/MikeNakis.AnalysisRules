<Project>
	<PropertyGroup>
		<MikeNakisAnalysisRules>$([System.IO.Path]::GetFullPath('$(MSBuildThisFileDirectory)../contentFiles/cs/any/MikeNakisAnalysisRules/'))</MikeNakisAnalysisRules>
	</PropertyGroup>
	<!--PEARL: UseHardlinksIfPossible:True does not work, even when building outside Visual Studio: the file gets
	           copied, not linked, and ErrorIfLinkFails:True has no effect. -->
	<!--PEARL: UseSymboliclinksIfPossible:True does in fact create a symlink, but:
				a) the file becomes writable, even though the file targeted by the symbolic link is not.
				a) the file has no effect. (Apparently the tooling does not respect symlinks.) -->
	<Target Name="CopyEditorConfig" BeforeTargets="BeforeBuild">
		<ItemGroup>
			<EditorConfigFilesToCopy Include="$(MikeNakisAnalysisRules).editorconfig" />
		</ItemGroup>
		<Copy SourceFiles="@(EditorConfigFilesToCopy)" DestinationFolder="$(ProjectDir)" SkipUnchangedFiles="False"
			OverwriteReadOnlyFiles="True" ContinueOnError="ErrorAndStop" />
		<MakeFileReadOnly filePath="$(ProjectDir).editorconfig" />
	</Target>
	<!-- PEARL: UsingTask ParameterType cannot be an enum! 
	            Ideally, this task would be a general-purpose SetFileAttributes task, but we cannot pass it an enum,
				because msbuild uses System.Convert.ChangeType to convert parameter types, and this fails on enums. 
				This: https://github.com/dotnet/msbuild/issues/316 indicates that this has been fixed, but it hasn't.
				Thus, we can either pass a string and parse it in the task, or narrow the scope of the task to only
				set the ReadOnly attribute. We opt for the latter.  -->
	<UsingTask TaskName="MakeFileReadOnly" TaskFactory="RoslynCodeTaskFactory" AssemblyFile="$(MSBuildToolsPath)\Microsoft.Build.Tasks.Core.dll" >
		<ParameterGroup>
			<filePath ParameterType="System.String" Required="true" />
		</ParameterGroup>
		<Task>
			<Code Type="Fragment" Language="cs">
				System.IO.File.SetAttributes( filePath, System.IO.FileAttributes.ReadOnly );
			</Code>
		</Task>
	</UsingTask>
</Project>
